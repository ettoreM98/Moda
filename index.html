<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HAWENISHLAND — Archivio Moda</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    /* --- STILE BASE (Login & Struttura) --- */
    body { background:#0a0a0a; color:#fff; font-family:'Inter',sans-serif; margin:0; height:100vh; overflow-x: hidden; }
    .serif { font-family:'Playfair Display',serif }
    .hidden { display:none!important }
    
    /* Login Layout */
    .split-layout { display:flex; height:100vh; width: 100vw; position: fixed; top:0; left:0; z-index: 50; background:#0a0a0a; transition: transform 0.8s ease-in-out; }
    .visual-side { flex:1; position:relative; overflow:hidden; display:none; background:#000 }
    @media (min-width:768px){ .visual-side{display:block} }

    .visual-side img{
      position:absolute; top:0; left:0; width:100%; height:100%;
      object-fit:cover; filter:grayscale(100%); opacity:0;
      transition:opacity 1.5s ease, filter .8s ease; z-index:0
    }
    .visual-side img.active{ opacity:1; z-index:1 }
    .visual-side img:hover{ filter:grayscale(0%); cursor:crosshair }

    .form-side{
      flex:1; display:flex; flex-direction:column; justify-content:center;
      padding:60px; background:#0a0a0a; max-width:600px; margin:auto
    }
    .input-group{ margin-bottom:25px }
    .input-label{
      display:block; font-size:10px; text-transform:uppercase;
      letter-spacing:2px; color:#555; margin-bottom:8px
    }
    input{
      background:transparent; border-bottom:1px solid #222;
      padding:10px 0; color:#fff; width:100%; outline:none; font-size:14px
    }
    input:focus{ border-bottom-color:#fff }
    .btn-white{
      background:#fff; color:#000; padding:18px; font-weight:500;
      text-transform:uppercase; width:100%; cursor:pointer;
      border:1px solid #fff; transition:.3s; margin-top:10px
    }
    .btn-white:hover{ background:#000; color:#fff }
    #msg-box{
      display:none; padding:12px; border:1px solid #333;
      font-size:11px; text-transform:uppercase;
      margin-bottom:20px; text-align:center
    }
    .link-small{
      text-align:center; margin-top:20px;
      font-size:10px; color:#555; cursor:pointer;
      text-transform:uppercase; letter-spacing:1px
    }

    /* --- STILI APP SOCIAL --- */
    #app-interface { display: none; min-height: 100vh; background: #000; }
    
    .app-layout { display: flex; max-width: 1400px; margin: 0 auto; min-height: 100vh; }
    
    /* Sidebar */
    .sidebar { width: 250px; border-right: 1px solid #262626; height: 100vh; position: sticky; top: 0; padding: 20px; display: flex; flex-direction: column; }
    .nav-item { display: flex; align-items: center; gap: 15px; padding: 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; color: #f5f5f5; margin-bottom: 5px; }
    .nav-item:hover { background: #1a1a1a; }
    .nav-item i { font-size: 20px; width: 25px; }

    /* Contenuto Centrale Dinamico */
    .main-content { flex: 1; padding: 40px; overflow-y: auto; }

    /* Feed & Post */
    .feed-container { max-width: 600px; margin: 0 auto; }
    .post-card { margin-bottom: 40px; border-bottom: 1px solid #262626; padding-bottom: 20px; }
    .post-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; background: #333; }
    .post-img { width: 100%; border-radius: 4px; border: 1px solid #262626; }
    .post-actions { display: flex; gap: 20px; margin-top: 12px; font-size: 22px; }
    .action-btn { cursor: pointer; transition: 0.2s; }
    .action-btn:hover { color: #888; }
    
    /* Right Sidebar */
    .suggestions { width: 300px; padding: 30px 0 0 30px; display: none; border-left: 1px solid #262626; }
    @media (min-width: 1000px) { .suggestions { display: block; } }
    
    .user-profile-link { cursor: pointer; transition: opacity 0.3s; }
    .user-profile-link:hover { opacity: 0.7; }

    /* --- VISTA IMPOSTAZIONI --- */
    .settings-container { max-width: 600px; margin: 0 auto; }
    .settings-header { font-size: 24px; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 10px; }
    
    /* --- VISTA BACHECA (DASHBOARD) --- */
    .dashboard-header { display: flex; align-items: center; gap: 30px; margin-bottom: 40px; border-bottom: 1px solid #262626; padding-bottom: 40px; }
    .dashboard-avatar { width: 150px; height: 150px; rounded: 50%; border-radius: 50%; object-fit: cover; border: 2px solid #333; }
    .stats { display: flex; gap: 20px; margin-top: 15px; font-size: 14px; }
    
    .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 50px; }
    .grid-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; cursor: pointer; transition: 0.3s; }
    .grid-img:hover { opacity: 0.8; }

    .notifications-box { background: #111; padding: 20px; border-radius: 8px; border: 1px solid #333; }
    .notif-item { font-size: 13px; padding: 10px 0; border-bottom: 1px solid #222; display: flex; gap: 10px; align-items: center; }
    .notif-item:last-child { border: none; }

    /* Modali */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
    .modal-box { background: #1a1a1a; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; border: 1px solid #333; position: relative; }
    
  </style>
</head>

<body>

<div id="auth-container" class="split-layout">

  <div class="visual-side">
    <img src="https://images.unsplash.com/photo-1617137984095-74e4e5e3613f?q=80&w=1200" class="active">
    <img src="https://images.unsplash.com/photo-1509631179647-0177331693ae?q=80&w=1200">
  </div>

  <div class="form-side">
    <h1 class="serif text-6xl mb-12 italic">Hawenishland</h1>
    <div id="msg-box"></div>

    <div id="login-form">
      <div class="input-group">
        <label class="input-label">Email</label>
        <input type="email" id="l-email">
      </div>
      <div class="input-group">
        <label class="input-label">Password</label>
        <input type="password" id="l-pass">
      </div>
      <button onclick="faiLogin()" class="btn-white">Entra</button>
      <p onclick="recuperoPassword()" class="link-small">Password dimenticata?</p>
      <p onclick="vaiA('signup')" class="link-small">Non hai un account? <b>Iscriviti</b></p>
    </div>

    <div id="signup-form" class="hidden">
      <div class="input-group">
        <label class="input-label">Username (Pubblico)</label>
        <input type="text" id="r-username" placeholder="es. mario.rossi99">
      </div>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div><label class="input-label">Nome</label><input type="text" id="r-nome"></div>
        <div><label class="input-label">Cognome</label><input type="text" id="r-cognome"></div>
      </div>
      
      <div class="input-group">
        <label class="input-label">Data di Nascita</label>
        <input type="date" id="r-nascita" style="color-scheme:dark">
      </div>
      <div class="input-group">
        <label class="input-label">Email</label>
        <input type="email" id="r-email">
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div><label class="input-label">Password</label><input type="password" id="r-pass"></div>
        <div><label class="input-label">Conferma Psw</label><input type="password" id="r-pass-conf"></div>
      </div>

      <button id="btn-reg" onclick="faiRegistrazione()" class="btn-white">Invia Richiesta</button>
      <p onclick="vaiA('login')" class="link-small">Torna al Login</p>
    </div>
  </div>
</div>

<div id="app-interface">
  <div class="app-layout">
    
    <div class="sidebar">
      <h1 class="serif italic text-2xl mb-8 pl-4 cursor-pointer" onclick="switchView('feed')">Hawenishland</h1>
      
      <div class="nav-item" onclick="switchView('feed')">
        <i class="fa-solid fa-house"></i>
        <span>Home</span>
      </div>
      <div class="nav-item" onclick="openSearch()">
        <i class="fa-solid fa-magnifying-glass"></i>
        <span>Cerca</span>
      </div>
      <div class="nav-item" onclick="openUploadModal()">
        <i class="fa-regular fa-square-plus"></i>
        <span>Crea</span>
      </div>
      <div class="nav-item" onclick="switchView('settings')">
        <i class="fa-regular fa-user"></i>
        <span>Profilo & Dati</span>
      </div>
      
      <div class="mt-auto nav-item text-red-500" onclick="logout()">
        <i class="fa-solid fa-arrow-right-from-bracket"></i>
        <span>Esci</span>
      </div>
    </div>

    <div class="main-content">
      
      <div id="view-feed" class="view-section">
        <div class="feed-container" id="posts-feed">
          </div>
      </div>

      <div id="view-settings" class="view-section hidden">
        <div class="settings-container">
          <h2 class="serif settings-header">Le tue Informazioni</h2>
          <div class="bg-[#111] p-8 rounded-lg border border-[#333]">
            <div class="input-group">
              <label class="input-label">Username</label>
              <input type="text" id="set-username" disabled class="text-gray-500 cursor-not-allowed">
              <small class="text-xs text-gray-500">Lo username non può essere cambiato.</small>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div class="input-group">
                <label class="input-label">Nome</label>
                <input type="text" id="set-nome">
              </div>
              <div class="input-group">
                <label class="input-label">Cognome</label>
                <input type="text" id="set-cognome">
              </div>
            </div>
            <div class="input-group">
              <label class="input-label">Email</label>
              <input type="email" id="set-email">
              <small class="text-xs text-yellow-500 hidden" id="email-warning">Modificando l'email riceverai una conferma al vecchio e nuovo indirizzo.</small>
            </div>
            <button onclick="salvaImpostazioni()" class="btn-white mt-4">Salva Modifiche</button>
          </div>
        </div>
      </div>

      <div id="view-dashboard" class="view-section hidden">
        <div class="dashboard-header">
          <img id="dash-avatar" src="" class="dashboard-avatar">
          <div>
            <h2 id="dash-username" class="text-2xl font-light mb-2">username</h2>
            <p id="dash-fullname" class="font-bold mb-4">Nome Cognome</p>
            <div class="stats">
              <span id="stat-posts"><b>0</b> post</span>
              <span><b>0</b> follower</span>
              <span><b>0</b> seguiti</span>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-2">
            <h3 class="text-xs uppercase tracking-widest text-gray-500 mb-4">I Miei Post</h3>
            <div id="dash-grid" class="dashboard-grid">
              </div>
          </div>

          <div>
            <h3 class="text-xs uppercase tracking-widest text-gray-500 mb-4">Notifiche & Like</h3>
            <div id="dash-notifs" class="notifications-box">
              <p class="text-center text-gray-600 text-xs">Nessuna attività recente.</p>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="suggestions">
      <div class="flex items-center justify-between mb-4 user-profile-link" onclick="switchView('dashboard')">
        <div class="flex items-center gap-3">
          <img id="my-side-avatar" src="https://via.placeholder.com/50" class="w-12 h-12 rounded-full border border-gray-700 object-cover">
          <div>
            <p id="my-username" class="font-bold text-sm">user</p>
            <p id="my-fullname" class="text-gray-500 text-xs">Nome Cognome</p>
          </div>
        </div>
        <span class="text-xs text-blue-400 font-bold">Vedi</span>
      </div>
      
      <hr class="border-gray-800 my-4">
      <h3 class="text-gray-500 font-bold text-xs mb-4">Suggeriti per te</h3>
      <div id="suggestions-list"></div>
    </div>
  </div>
</div>

<div id="upload-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <i class="fa-solid fa-xmark absolute top-4 right-4 cursor-pointer text-xl" onclick="document.getElementById('upload-modal').classList.add('hidden')"></i>
    <h2 class="serif text-xl mb-4 italic">Nuovo Post</h2>
    <div class="input-group">
      <label class="input-label">Foto</label>
      <input type="file" id="post-file" accept="image/*">
    </div>
    <div class="input-group">
      <label class="input-label">Didascalia</label>
      <input type="text" id="post-caption" placeholder="...">
    </div>
    <button onclick="submitPost()" class="btn-white">Condividi</button>
  </div>
</div>

<div id="search-modal" class="modal-overlay hidden">
  <div class="modal-box">
    <i class="fa-solid fa-xmark absolute top-4 right-4 cursor-pointer text-xl" onclick="document.getElementById('search-modal').classList.add('hidden')"></i>
    <h2 class="serif text-xl mb-4 italic">Cerca</h2>
    <input type="text" id="search-query" placeholder="Cerca utenti..." class="w-full bg-[#111] border-none p-3 rounded mb-4 text-white" onkeyup="performSearch()">
    <div id="search-results" class="max-h-60 overflow-y-auto"></div>
  </div>
</div>

<script>
  /* ================= INIT SUPABASE ================= */
  const SB_URL = 'https://nqeuecpgvqexhpztpois.supabase.co';
  const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xZXVlY3BndnFleGhwenRwb2lzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNjYwMDksImV4cCI6MjA4Mzc0MjAwOX0.v7U65EtUk1tXcwS3e2Hl0wipT5NbuHO439XvO1h8Kxc';

  const sb = window.supabase.createClient(SB_URL, SB_KEY);
  let currentUser = null;

  /* ================= AUTH SYSTEM ================= */
  
  window.addEventListener('load', async () => {
    const { data: { session } } = await sb.auth.getSession();
    if (session) enterApp(session.user);
  });

  async function enterApp(user) {
    currentUser = user;
    document.getElementById('auth-container').style.transform = "translateY(-100vh)";
    setTimeout(() => {
      document.getElementById('auth-container').style.display = 'none';
      document.getElementById('app-interface').style.display = 'block';
      
      // Carica dati iniziali
      loadUserData();
      switchView('feed'); // Carica la home
      loadSuggestions();
    }, 600);
  }

  function mess(t, err=false) {
    const b = document.getElementById('msg-box');
    b.innerText = t;
    b.style.display = 'block';
    b.style.color = err ? '#ff4444' : '#44ff44';
  }

  function vaiA(m) {
    document.getElementById('login-form').classList.toggle('hidden', m === 'signup');
    document.getElementById('signup-form').classList.toggle('hidden', m === 'login');
    document.getElementById('msg-box').style.display = 'none';
  }

  // --- REGISTRAZIONE AGGIORNATA ---
  async function faiRegistrazione() {
    const userNick = document.getElementById('r-username').value.trim();
    const email = document.getElementById('r-email').value.trim();
    const pass = document.getElementById('r-pass').value;
    const passConf = document.getElementById('r-pass-conf').value;
    const nome = document.getElementById('r-nome').value.trim();
    const cognome = document.getElementById('r-cognome').value.trim();

    if (!userNick || !email || !pass || !nome) return mess("Compila tutti i campi.", true);
    if (pass !== passConf) return mess("Le password non coincidono.", true);
    if (pass.length < 6) return mess("Password troppo corta.", true);

    try {
      mess("Creazione account...", false);
      
      // 1. Crea Auth User
      const { data, error } = await sb.auth.signUp({
        email: email,
        password: pass,
        options: { data: { first_name: nome, last_name: cognome } }
      });
      if (error) throw error;

      // 2. Crea Profilo con Username scelto
      if (data.user) {
        // Controllo se username esiste già (opzionale, altrimenti DB darà errore)
        const { error: dbError } = await sb.from('profiles').insert([{
          id: data.user.id,
          username: userNick.toLowerCase(),
          full_name: `${nome} ${cognome}`,
          avatar_url: 'https://via.placeholder.com/150'
        }]);
        
        if(dbError) throw new Error("Username già in uso o errore server.");
      }

      mess("Registrato! Controlla l'email.");
      setTimeout(() => vaiA('login'), 2000);

    } catch (err) {
      mess(err.message, true);
    }
  }

  async function faiLogin() {
    const e = document.getElementById('l-email').value.trim();
    const p = document.getElementById('l-pass').value;
    const { data, error } = await sb.auth.signInWithPassword({ email: e, password: p });
    if (error) mess("Credenziali errate.", true);
    else enterApp(data.user);
  }

  async function logout() {
    await sb.auth.signOut();
    location.reload();
  }

  /* ================= NAVIGAZIONE VIEW ================= */
  
  function switchView(viewName) {
    // Nascondi tutto
    ['view-feed', 'view-settings', 'view-dashboard'].forEach(id => {
      document.getElementById(id).classList.add('hidden');
    });

    // Mostra selezionato
    document.getElementById(`view-${viewName}`).classList.remove('hidden');

    // Carica dati specifici
    if (viewName === 'feed') loadFeed();
    if (viewName === 'settings') loadSettingsData();
    if (viewName === 'dashboard') loadMyDashboard();
  }

  /* ================= LOGICA SOCIAL ================= */

  // Carica info Sidebar Destra
  async function loadUserData() {
    const { data } = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
    if(data) {
      document.getElementById('my-username').innerText = data.username;
      document.getElementById('my-fullname').innerText = data.full_name;
      if(data.avatar_url) document.getElementById('my-side-avatar').src = data.avatar_url;
    }
  }

  // 1. FEED HOME
  async function loadFeed() {
    const feed = document.getElementById('posts-feed');
    feed.innerHTML = '<p class="text-center text-gray-600 mt-10">Aggiornamento...</p>';

    const { data: posts } = await sb
      .from('posts')
      .select('*, profiles(username, avatar_url), likes(user_id)')
      .order('created_at', { ascending: false });

    feed.innerHTML = '';
    if(!posts || posts.length === 0) {
      feed.innerHTML = '<p class="text-center text-gray-600">Nessun post ancora.</p>';
      return;
    }

    posts.forEach(p => {
      const isLiked = p.likes && p.likes.some(l => l.user_id === currentUser.id);
      const heartClass = isLiked ? "fa-solid text-red-500" : "fa-regular";
      
      feed.innerHTML += `
        <div class="post-card">
          <div class="post-header">
            <img src="${p.profiles?.avatar_url}" class="user-avatar">
            <span class="font-bold text-sm">${p.profiles?.username}</span>
          </div>
          <img src="${p.image_url}" class="post-img" ondblclick="toggleLike('${p.id}')">
          <div class="post-actions">
            <i class="${heartClass} fa-heart action-btn" onclick="toggleLike('${p.id}')"></i>
            <i class="fa-regular fa-comment action-btn"></i>
          </div>
          <div class="post-caption mt-2 text-sm">
            <b>${p.profiles?.username}</b> ${p.caption || ''}
          </div>
        </div>
      `;
    });
  }

  async function toggleLike(postId) {
    // Controlla se ho già messo like
    const { data } = await sb.from('likes').select('*').eq('post_id', postId).eq('user_id', currentUser.id);
    
    if (data.length > 0) {
      // Tolgo like
      await sb.from('likes').delete().eq('post_id', postId).eq('user_id', currentUser.id);
    } else {
      // Metto like
      await sb.from('likes').insert([{ post_id: postId, user_id: currentUser.id }]);
    }
    loadFeed(); // Ricarica veloce (non ottimizzato ma funzionale)
  }

  // 2. IMPOSTAZIONI (PROFILO)
  async function loadSettingsData() {
    const { data } = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
    if(data) {
      document.getElementById('set-username').value = data.username; // Read only
      const names = data.full_name.split(' ');
      document.getElementById('set-nome').value = names[0] || '';
      document.getElementById('set-cognome').value = names.slice(1).join(' ') || '';
    }
    document.getElementById('set-email').value = currentUser.email;
    
    // Mostra avviso email se si inizia a digitare
    document.getElementById('set-email').addEventListener('input', () => {
      document.getElementById('email-warning').classList.remove('hidden');
    });
  }

  async function salvaImpostazioni() {
    const nome = document.getElementById('set-nome').value;
    const cognome = document.getElementById('set-cognome').value;
    const newEmail = document.getElementById('set-email').value;

    // Aggiorna Profilo Pubblico
    await sb.from('profiles').update({
      full_name: `${nome} ${cognome}`
    }).eq('id', currentUser.id);

    // Aggiorna Email (Auth)
    if(newEmail !== currentUser.email) {
      const { error } = await sb.auth.updateUser({ email: newEmail });
      if(error) alert("Errore email: " + error.message);
      else alert("Profilo aggiornato! Controlla la tua vecchia e nuova email per confermare il cambio.");
    } else {
      alert("Profilo aggiornato correttamente.");
    }
    loadUserData(); // Aggiorna sidebar
  }

  // 3. BACHECA PERSONALE (Dashboard)
  async function loadMyDashboard() {
    // Info Utente
    const { data: profile } = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
    document.getElementById('dash-username').innerText = profile.username;
    document.getElementById('dash-fullname').innerText = profile.full_name;
    document.getElementById('dash-avatar').src = profile.avatar_url;

    // Carica Miei Post
    const { data: myPosts } = await sb.from('posts').select('*').eq('user_id', currentUser.id);
    document.getElementById('stat-posts').innerHTML = `<b>${myPosts?.length || 0}</b> post`;
    
    const grid = document.getElementById('dash-grid');
    grid.innerHTML = '';
    myPosts?.forEach(p => {
      grid.innerHTML += `<img src="${p.image_url}" class="grid-img">`;
    });

    // Carica Notifiche (Chi ha messo like ai miei post)
    // Query complessa: prendi i like dove il post appartiene a ME
    const { data: likes } = await sb
      .from('likes')
      .select('created_at, profiles(username), posts!inner(id, image_url)')
      .eq('posts.user_id', currentUser.id)
      .order('created_at', { ascending: false })
      .limit(20);

    const notifBox = document.getElementById('dash-notifs');
    notifBox.innerHTML = '';
    
    if(!likes || likes.length === 0) {
      notifBox.innerHTML = '<p class="text-center text-gray-500 text-xs">Nessuna notifica.</p>';
    } else {
      likes.forEach(l => {
        notifBox.innerHTML += `
          <div class="notif-item">
            <span class="font-bold text-white">${l.profiles.username}</span>
            <span class="text-gray-400">ha messo like alla tua foto.</span>
            <img src="${l.posts.image_url}" class="w-8 h-8 rounded object-cover ml-auto border border-gray-700">
          </div>
        `;
      });
    }
  }

  /* ================= UTILITY UPLOAD & CERCA ================= */
  function openUploadModal() { document.getElementById('upload-modal').classList.remove('hidden'); }
  
  async function submitPost() {
    const file = document.getElementById('post-file').files[0];
    const caption = document.getElementById('post-caption').value;
    if(!file) return alert("Manca la foto!");

    const fileName = `post_${Date.now()}`;
    await sb.storage.from('posts').upload(fileName, file);
    const { data: { publicUrl } } = sb.storage.from('posts').getPublicUrl(fileName);

    await sb.from('posts').insert([{ user_id: currentUser.id, image_url: publicUrl, caption: caption }]);
    
    document.getElementById('upload-modal').classList.add('hidden');
    switchView('feed');
  }

  function openSearch() { document.getElementById('search-modal').classList.remove('hidden'); }
  
  async function performSearch() {
    const q = document.getElementById('search-query').value;
    if(q.length < 2) return;
    const { data } = await sb.from('profiles').select('*').ilike('username', `%${q}%`);
    const res = document.getElementById('search-results');
    res.innerHTML = '';
    data?.forEach(u => {
      res.innerHTML += `
        <div class="flex items-center justify-between p-2 hover:bg-[#222] rounded">
           <div class="flex items-center gap-2">
             <img src="${u.avatar_url}" class="w-8 h-8 rounded-full">
             <span>${u.username}</span>
           </div>
        </div>`;
    });
  }

  async function loadSuggestions() {
    const { data } = await sb.from('profiles').select('*').neq('id', currentUser.id).limit(3);
    const list = document.getElementById('suggestions-list');
    list.innerHTML = '';
    data?.forEach(u => {
      list.innerHTML += `
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <img src="${u.avatar_url}" class="w-8 h-8 rounded-full bg-gray-800">
            <span class="text-xs font-bold">${u.username}</span>
          </div>
          <span class="text-xs text-blue-400 cursor-pointer">Segui</span>
        </div>
      `;
    });
  }

  /* ================= SLIDER LOGIN ================= */
  let idx = 0;
  const imgs = document.querySelectorAll('.visual-side img');
  setInterval(() => {
    imgs[idx].classList.remove('active');
    idx = (idx + 1) % imgs.length;
    imgs[idx].classList.add('active');
  }, 5000);

</script>
</body>
</html>
