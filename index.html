<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hawenishland</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

<style>
body{background:#0a0a0a;color:#fff;font-family:'Inter';margin:0}
.serif{font-family:'Playfair Display'}
.hidden{display:none}
.visual img{filter:grayscale(100%);transition:filter 1s}
.visual img:hover{filter:grayscale(0%)}
</style>
</head>

<body>

<!-- AUTH -->
<div id="auth">
  <h1 class="serif text-6xl italic text-center mt-20">Hawenishland</h1>

  <div class="max-w-md mx-auto mt-12">
    <input id="email" placeholder="Email" class="w-full bg-transparent border-b p-3 mb-4">
    <input id="password" type="password" placeholder="Password" class="w-full bg-transparent border-b p-3 mb-6">

    <button onclick="login()" class="w-full bg-white text-black p-4 uppercase">Entra</button>
    <button onclick="signup()" class="w-full mt-3 border p-4 uppercase">Registrati</button>

    <p id="msg" class="text-center text-sm mt-4"></p>
  </div>
</div>

<!-- HOME -->
<div id="home" class="hidden">
  <header class="p-6 border-b border-neutral-800 flex justify-between">
    <h2 class="serif italic text-3xl">Hawenishland</h2>
    <button onclick="logout()">Logout</button>
  </header>

  <main class="max-w-2xl mx-auto mt-10">
    <textarea id="postText" placeholder="Scrivi qualcosa..."
      class="w-full bg-transparent border p-4 mb-4"></textarea>

    <button onclick="createPost()" class="bg-white text-black p-3 uppercase">
      Pubblica
    </button>

    <div id="feed" class="mt-12 space-y-10"></div>
  </main>
</div>

<script>
const SUPABASE_URL = "https://nqueucpgvqexhpztpois.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xZXVlY3BndnFleGhwenRwb2lzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxNjYwMDksImV4cCI6MjA4Mzc0MjAwOX0.v7U65EtUk1tXcwS3e2Hl0wipT5NbuHO439XvO1h8Kxc";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const auth = document.getElementById('auth');
const home = document.getElementById('home');
const msg = document.getElementById('msg');

sb.auth.getSession().then(({data})=>{
  if(data.session) showHome();
});

function showHome(){
  auth.classList.add('hidden');
  home.classList.remove('hidden');
  loadPosts();
}

async function login(){
  const {error} = await sb.auth.signInWithPassword({
    email: email.value,
    password: password.value
  });
  if(error) msg.innerText = error.message;
  else showHome();
}

async function signup(){
  const {error} = await sb.auth.signUp({
    email: email.value,
    password: password.value
  });
  msg.innerText = error ? error.message : "Controlla la mail.";
}

async function logout(){
  await sb.auth.signOut();
  location.reload();
}

async function createPost(){
  const user = (await sb.auth.getUser()).data.user;
  await sb.from('posts').insert({
    content: postText.value,
    user_id: user.id
  });
  postText.value='';
  loadPosts();
}

async function loadPosts(){
  const {data} = await sb.from('posts').select('*').order('created_at',{ascending:false});
  feed.innerHTML='';
  data.forEach(p=>{
    feed.innerHTML+=`
      <div class="border-b border-neutral-800 pb-6">
        <p class="italic serif text-lg">${p.content}</p>
      </div>
    `;
  });
}
</script>

</body>
</html>
